class FormHelpers{constructor(options ={}){this.options ={validateOnBlur:options.validateOnBlur !== false,validateOnInput:options.validateOnInput !== false,showToastOnError:options.showToastOnError !== false,...options};this.validators = new Map();this.masks = new Map();this.init();}init(){console.log('Form Helpers System inicializado');this.setupDefaultValidators();this.setupDefaultMasks();this.attachFormHandlers();this.setupInputTypes();}setupDefaultValidators(){this.addValidator('email',(value)=>{const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;return{valid:emailRegex.test(value),message:'Digite um e-mail válido'};});this.addValidator('telefone',(value)=>{const cleanValue = value.replace(/\D/g,'');const isValid = cleanValue.length === 10 || cleanValue.length === 11;return{valid:isValid,message:'Digite um telefone válido(10 ou 11 dígitos)'};});this.addValidator('cpf',(value)=>{const cleanValue = value.replace(/\D/g,'');if(cleanValue.length !== 11){return{valid:false,message:'CPF deve ter 11 dígitos'};}if(/^(\d)\1{10}$/.test(cleanValue)){return{valid:false,message:'CPF inválido'};}return{valid:this.validateCPF(cleanValue),message:'CPF inválido'};});this.addValidator('cnpj',(value)=>{const cleanValue = value.replace(/\D/g,'');if(cleanValue.length !== 14){return{valid:false,message:'CNPJ deve ter 14 dígitos'};}return{valid:this.validateCNPJ(cleanValue),message:'CNPJ inválido'};});this.addValidator('valor',(value)=>{const cleanValue = value.replace(/[^\d,]/g,'').replace(',','.');const numValue = parseFloat(cleanValue);return{valid:!isNaN(numValue)&& numValue > 0,message:'Digite um valor válido maior que zero'};});this.addValidator('required',(value)=>{const isValid = value && value.trim().length > 0;return{valid:isValid,message:'Este campo é obrigatório'};});this.addValidator('senha-forte',(value)=>{const hasMinLength = value.length >= 8;const hasUpperCase = /[A-Z]/.test(value);const hasLowerCase = /[a-z]/.test(value);const hasNumber = /\d/.test(value);const isValid = hasMinLength && hasUpperCase && hasLowerCase && hasNumber;let message = 'A senha deve ter:';if(!hasMinLength)message += ' pelo menos 8 caracteres,';if(!hasUpperCase)message += ' letra maiúscula,';if(!hasLowerCase)message += ' letra minúscula,';if(!hasNumber)message += ' número,';message = message.replace(/,$/,'');return{valid:isValid,message:isValid ? '':message};});this.addValidator('confirmar-senha',(value,input)=>{const form = input.closest('form');const senhaInput = form.querySelector('[data-validate="senha-forte"],[type="password"]:not([data-validate="confirmar-senha"])');const senhaValue = senhaInput ? senhaInput.value:'';return{valid:value === senhaValue,message:'As senhas não coincidem'};});this.addValidator('min',(value,input)=>{const min = parseFloat(input.dataset.min || input.min);const numValue = parseFloat(value);return{valid:!isNaN(numValue)&& numValue >= min,message:`O valor mínimo é ${min}`};});this.addValidator('max',(value,input)=>{const max = parseFloat(input.dataset.max || input.max);const numValue = parseFloat(value);return{valid:!isNaN(numValue)&& numValue <= max,message:`O valor máximo é ${max}`};});this.addValidator('minlength',(value,input)=>{const minLength = parseInt(input.dataset.minlength || input.minLength);return{valid:value.length >= minLength,message:`Mínimo de ${minLength}caracteres`};});this.addValidator('maxlength',(value,input)=>{const maxLength = parseInt(input.dataset.maxlength || input.maxLength);return{valid:value.length <= maxLength,message:`Máximo de ${maxLength}caracteres`};});}setupDefaultMasks(){this.addMask('telefone',(value)=>{const cleaned = value.replace(/\D/g,'');if(cleaned.length <= 10){return cleaned
.replace(/^(\d{2})(\d)/,'($1)$2').replace(/(\d{4})(\d)/,'$1-$2');}else{return cleaned
.replace(/^(\d{2})(\d)/,'($1)$2').replace(/(\d{5})(\d)/,'$1-$2').substring(0,15);}});this.addMask('cpf',(value)=>{return value
.replace(/\D/g,'').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})$/,'$1-$2').substring(0,14);});this.addMask('cnpj',(value)=>{return value
.replace(/\D/g,'').replace(/(\d{2})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1/$2').replace(/(\d{4})(\d{1,2})$/,'$1-$2').substring(0,18);});this.addMask('cep',(value)=>{return value
.replace(/\D/g,'').replace(/(\d{5})(\d)/,'$1-$2').substring(0,9);});this.addMask('valor',(value)=>{let cleaned = value.replace(/\D/g,'');if(cleaned === '')return '';let number = parseInt(cleaned)/ 100;return number.toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2});});this.addMask('data',(value)=>{return value
.replace(/\D/g,'').replace(/(\d{2})(\d)/,'$1/$2').replace(/(\d{2})(\d)/,'$1/$2').substring(0,10);});this.addMask('hora',(value)=>{return value
.replace(/\D/g,'').replace(/(\d{2})(\d)/,'$1:$2').substring(0,5);});this.addMask('numero',(value)=>{return value.replace(/\D/g,'');});this.addMask('texto',(value)=>{return value.replace(/[^a-zA-ZÀ-ÿ\s]/g,'');});}addValidator(name,validatorFn){this.validators.set(name,validatorFn);}addMask(name,maskFn){this.masks.set(name,maskFn);}validateField(input){const validators =(input.dataset.validate || '').split(',').map(v => v.trim()).filter(v => v);if(input.required && !validators.includes('required')){validators.unshift('required');}let isValid = true;let errorMessage = '';for(const validatorName of validators){const validator = this.validators.get(validatorName);if(!validator){console.warn(`Validador não encontrado:${validatorName}`);continue;}const result = validator(input.value,input);if(!result.valid){isValid = false;errorMessage = result.message;break;}}this.updateFieldUI(input,isValid,errorMessage);return isValid;}updateFieldUI(input,isValid,errorMessage){const formGroup = input.closest('.form-group,.mb-3,.field-group');if(!formGroup)return;formGroup.classList.remove('has-error','has-success');input.classList.remove('is-invalid','is-valid');const oldError = formGroup.querySelector('.error-message,.invalid-feedback');if(oldError){oldError.remove();}if(input.value.trim()=== ''){return;}if(isValid){formGroup.classList.add('has-success');input.classList.add('is-valid');}else{formGroup.classList.add('has-error');input.classList.add('is-invalid');const errorDiv = document.createElement('div');errorDiv.className = 'error-message invalid-feedback';errorDiv.textContent = errorMessage;errorDiv.style.display = 'block';formGroup.appendChild(errorDiv);}}applyMask(input){const maskName = input.dataset.mask;if(!maskName)return;const maskFn = this.masks.get(maskName);if(!maskFn){console.warn(`Máscara não encontrada:${maskName}`);return;}const cursorPosition = input.selectionStart;const oldValue = input.value;const newValue = maskFn(oldValue);if(newValue !== oldValue){input.value = newValue;const diff = newValue.length - oldValue.length;input.setSelectionRange(cursorPosition + diff,cursorPosition + diff);}}attachFormHandlers(){document.addEventListener('input',(e)=>{const input = e.target;if(input.dataset.mask){this.applyMask(input);}if(this.options.validateOnInput && input.dataset.validate){this.validateField(input);}});document.addEventListener('blur',(e)=>{const input = e.target;if(this.options.validateOnBlur &&(input.dataset.validate || input.required)){this.validateField(input);}},true);document.addEventListener('submit',(e)=>{const form = e.target;if(form.noValidate || form.dataset.noValidate === 'true'){return;}const isValid = this.validateForm(form);if(!isValid){e.preventDefault();e.stopPropagation();if(this.options.showToastOnError && window.toast){window.toast.error('Por favor,corrija os erros no formulário');}const firstError = form.querySelector('.is-invalid,.has-error input');if(firstError){firstError.focus();firstError.scrollIntoView({behavior:'smooth',block:'center'});}return false;}});}validateForm(form){const inputs = form.querySelectorAll('input,textarea,select');let isValid = true;inputs.forEach(input =>{if(input.disabled || input.readOnly){return;}if(input.dataset.validate || input.required){const fieldValid = this.validateField(input);if(!fieldValid){isValid = false;}}});return isValid;}setupInputTypes(){document.querySelectorAll('[data-mask="telefone"]').forEach(input =>{input.type = 'tel';input.inputMode = 'tel';});document.querySelectorAll('[data-mask="valor"]').forEach(input =>{input.type = 'text';input.inputMode = 'decimal';});document.querySelectorAll('[data-validate="email"]').forEach(input =>{if(input.type !== 'email'){input.type = 'email';}input.inputMode = 'email';});document.querySelectorAll('[data-mask="numero"]').forEach(input =>{input.type = 'text';input.inputMode = 'numeric';});document.querySelectorAll('[data-mask="cpf"],[data-mask="cnpj"]').forEach(input =>{input.type = 'text';input.inputMode = 'numeric';});}validateCPF(cpf){let sum = 0;let remainder;for(let i = 1;i <= 9;i++){sum += parseInt(cpf.substring(i - 1,i))*(11 - i);}remainder =(sum * 10)% 11;if(remainder === 10 || remainder === 11)remainder = 0;if(remainder !== parseInt(cpf.substring(9,10)))return false;sum = 0;for(let i = 1;i <= 10;i++){sum += parseInt(cpf.substring(i - 1,i))*(12 - i);}remainder =(sum * 10)% 11;if(remainder === 10 || remainder === 11)remainder = 0;if(remainder !== parseInt(cpf.substring(10,11)))return false;return true;}validateCNPJ(cnpj){let size = cnpj.length - 2;let numbers = cnpj.substring(0,size);let digits = cnpj.substring(size);let sum = 0;let pos = size - 7;for(let i = size;i >= 1;i--){sum += numbers.charAt(size - i)* pos--;if(pos < 2)pos = 9;}let result = sum % 11 < 2 ? 0:11 -(sum % 11);if(result != digits.charAt(0))return false;size = size + 1;numbers = cnpj.substring(0,size);sum = 0;pos = size - 7;for(let i = size;i >= 1;i--){sum += numbers.charAt(size - i)* pos--;if(pos < 2)pos = 9;}result = sum % 11 < 2 ? 0:11 -(sum % 11);if(result != digits.charAt(1))return false;return true;}clearFieldValidation(input){const formGroup = input.closest('.form-group,.mb-3,.field-group');if(formGroup){formGroup.classList.remove('has-error','has-success');}input.classList.remove('is-invalid','is-valid');const errorMessage = formGroup?.querySelector('.error-message,.invalid-feedback');if(errorMessage){errorMessage.remove();}}clearFormValidation(form){const inputs = form.querySelectorAll('input,textarea,select');inputs.forEach(input => this.clearFieldValidation(input));}getCleanValue(input){const maskName = input.dataset.mask;if(!maskName){return input.value;}switch(maskName){case 'telefone':case 'cpf':case 'cnpj':case 'cep':case 'numero':return input.value.replace(/\D/g,'');case 'valor':return input.value.replace(/[^\d,]/g,'').replace(',','.');default:return input.value;}}setMaskedValue(input,value){input.value = value;this.applyMask(input);}}const validationStyles = `
.form-group.has-error input,.form-group.has-error textarea,.form-group.has-error select,input.is-invalid,textarea.is-invalid,select.is-invalid{border-color:#dc3545;background-color:#fff5f5;}.form-group.has-success input,.form-group.has-success textarea,.form-group.has-success select,input.is-valid,textarea.is-valid,select.is-valid{border-color:#28a745;background-color:#f0fff4;}.error-message,.invalid-feedback{color:#dc3545;font-size:0.875rem;margin-top:0.25rem;display:block;}.form-group.has-error input::after,input.is-invalid::after{content:'✕';color:#dc3545;}.form-group.has-success input::after,input.is-valid::after{content:'✓';color:#28a745;}@media(max-width:768px){input,textarea,select{min-height:44px;font-size:16px;}.error-message,.invalid-feedback{font-size:0.8rem;}}input:focus,textarea:focus,select:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 0.2rem rgba(0,123,255,0.25);}input.is-invalid:focus{border-color:#dc3545;box-shadow:0 0 0 0.2rem rgba(220,53,69,0.25);}input.is-valid:focus{border-color:#28a745;box-shadow:0 0 0 0.2rem rgba(40,167,69,0.25);}`;function injectValidationStyles(){const styleId = 'form-helpers-styles';if(!document.getElementById(styleId)){const style = document.createElement('style');style.id = styleId;style.textContent = validationStyles;document.head.appendChild(style);}}let formHelpersInstance = null;function initFormHelpers(options ={}){injectValidationStyles();formHelpersInstance = new FormHelpers(options);return formHelpersInstance;}if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',()=> initFormHelpers());}else{initFormHelpers();}window.FormHelpers = FormHelpers;window.formHelpers = formHelpersInstance;window.initFormHelpers = initFormHelpers;