class InviteInteractions{constructor(){this.init();}init(){this.setupEventListeners();this.setupFormValidations();this.setupLoadingStates();this.setupConfirmations();this.setupVisualFeedback();}setupEventListeners(){const rejectBtn = document.querySelector('.reject-btn');if(rejectBtn){rejectBtn.addEventListener('click',(e)=> this.handleRejectClick(e));}const rejectForm = document.getElementById('rejectForm');if(rejectForm){rejectForm.addEventListener('submit',(e)=> this.handleRejectSubmit(e));}const quickReasonButtons = document.querySelectorAll('.quick-reason');quickReasonButtons.forEach(button =>{button.addEventListener('click',(e)=> this.handleQuickReason(e));});const cadastroForm = document.getElementById('cadastroForm');const loginForm = document.getElementById('loginForm');if(cadastroForm){cadastroForm.addEventListener('submit',(e)=> this.handleCadastroSubmit(e));}if(loginForm){loginForm.addEventListener('submit',(e)=> this.handleLoginSubmit(e));}}setupFormValidations(){const passwordInput = document.getElementById('password');const confirmPasswordInput = document.getElementById('confirm_password');if(passwordInput && confirmPasswordInput){passwordInput.addEventListener('input',()=> this.validatePasswords());confirmPasswordInput.addEventListener('input',()=> this.validatePasswords());}const cpfInput = document.getElementById('cpf');if(cpfInput){cpfInput.addEventListener('input',(e)=> this.applyCpfMask(e));}const phoneInput = document.getElementById('phone');if(phoneInput){phoneInput.addEventListener('input',(e)=> this.applyPhoneMask(e));}const emailInputs = document.querySelectorAll('input[type="email"]');emailInputs.forEach(input =>{input.addEventListener('blur',(e)=> this.validateEmail(e));});}setupLoadingStates(){const submitButtons = document.querySelectorAll('button[type="submit"]');submitButtons.forEach(button =>{const form = button.closest('form');if(form){form.addEventListener('submit',()=>{this.setButtonLoading(button,true);});}});}setupConfirmations(){const confirmRejectBtn = document.querySelector('.confirm-reject-btn');if(confirmRejectBtn){confirmRejectBtn.addEventListener('click',(e)=>{if(!this.confirmRejectAction()){e.preventDefault();return false;}});}}setupVisualFeedback(){const formInputs = document.querySelectorAll('input,textarea,select');formInputs.forEach(input =>{input.addEventListener('focus',(e)=> this.addFocusEffect(e.target));input.addEventListener('blur',(e)=> this.removeFocusEffect(e.target));input.addEventListener('input',(e)=> this.updateFieldStatus(e.target));});const buttons = document.querySelectorAll('.btn');buttons.forEach(button =>{button.addEventListener('mouseenter',(e)=> this.addHoverEffect(e.target));button.addEventListener('mouseleave',(e)=> this.removeHoverEffect(e.target));});}handleAcceptClick(e){const button = e.target.closest('button');if(!confirm('Tem certeza que deseja aceitar este convite?\n\nVocê será direcionado para fazer login ou criar sua conta.')){e.preventDefault();return false;}setTimeout(()=>{this.setButtonLoading(button,true,'Aceitar Convite','Processando...');},10);this.showSuccessMessage('Convite aceito! Redirecionando...');return true;}handleRejectClick(e){const button = e.target.closest('button');this.setButtonLoading(button,true,'Rejeitar Convite','Abrindo...');setTimeout(()=>{this.setButtonLoading(button,false,'Rejeitar Convite');},300);}handleRejectSubmit(e){const form = e.target;const submitBtn = form.querySelector('.confirm-reject-btn');if(submitBtn){this.setButtonLoading(submitBtn,true,'Confirmar Rejeição','Rejeitando...');}this.showInfoMessage('Processando rejeição do convite...');return true;}handleQuickReason(e){const button = e.target.closest('button');const reason = button.getAttribute('data-reason');const textarea = document.getElementById('reject_reason');if(textarea && reason){textarea.value = reason;textarea.focus();document.querySelectorAll('.quick-reason').forEach(btn =>{btn.classList.remove('btn-primary');btn.classList.add('btn-outline-secondary');});button.classList.remove('btn-outline-secondary');button.classList.add('btn-primary');this.showSuccessMessage('Motivo selecionado!');}}handleCadastroSubmit(e){const form = e.target;if(!this.validateCadastroForm(form)){e.preventDefault();return false;}if(!confirm('Deseja criar sua conta e visualizar o convite?')){e.preventDefault();return false;}const submitBtn = form.querySelector('button[type="submit"]');if(submitBtn){this.setButtonLoading(submitBtn,true,'Criar Conta e Ver Convite','Criando conta...');}return true;}handleLoginSubmit(e){const form = e.target;const password = form.querySelector('#login_password');if(!password || !password.value.trim()){e.preventDefault();this.showErrorMessage('Digite sua senha para fazer login!');if(password)password.focus();return false;}const submitBtn = form.querySelector('button[type="submit"]');if(submitBtn){this.setButtonLoading(submitBtn,true,'Entrar e Ver Convite','Fazendo login...');}return true;}validateCadastroForm(form){const password = form.querySelector('#password');const confirmPassword = form.querySelector('#confirm_password');const terms = form.querySelector('#terms');const nome = form.querySelector('#nome');const email = form.querySelector('#email');const cpf = form.querySelector('#cpf');if(!nome || !nome.value.trim()){this.showErrorMessage('Nome completo é obrigatório!');if(nome)nome.focus();return false;}if(!email || !this.isValidEmail(email.value)){this.showErrorMessage('Digite um email válido!');if(email)email.focus();return false;}if(!cpf || !this.isValidCPF(cpf.value)){this.showErrorMessage('Digite um CPF válido!');if(cpf)cpf.focus();return false;}if(!password || password.value.length < 6){this.showErrorMessage('A senha deve ter pelo menos 6 caracteres!');if(password)password.focus();return false;}if(!confirmPassword || password.value !== confirmPassword.value){this.showErrorMessage('As senhas não coincidem!');if(confirmPassword)confirmPassword.focus();return false;}if(!terms || !terms.checked){this.showErrorMessage('Você deve aceitar os termos de uso!');if(terms)terms.focus();return false;}return true;}validatePasswords(){const password = document.getElementById('password');const confirmPassword = document.getElementById('confirm_password');if(password && confirmPassword){if(password.value !== confirmPassword.value){confirmPassword.setCustomValidity('As senhas não coincidem');this.addFieldError(confirmPassword,'As senhas não coincidem');}else{confirmPassword.setCustomValidity('');this.removeFieldError(confirmPassword);}}}applyCpfMask(e){let value = e.target.value.replace(/\D/g,'');value = value.replace(/(\d{3})(\d)/,'$1.$2');value = value.replace(/(\d{3})(\d)/,'$1.$2');value = value.replace(/(\d{3})(\d{1,2})$/,'$1-$2');e.target.value = value;if(value.length === 14){if(this.isValidCPF(value)){this.addFieldSuccess(e.target);}else{this.addFieldError(e.target,'CPF inválido');}}}applyPhoneMask(e){let value = e.target.value.replace(/\D/g,'');value = value.replace(/(\d{2})(\d)/,'($1)$2');value = value.replace(/(\d{5})(\d)/,'$1-$2');e.target.value = value;}validateEmail(e){const email = e.target.value;if(email && !this.isValidEmail(email)){this.addFieldError(e.target,'Email inválido');}else if(email){this.addFieldSuccess(e.target);}}confirmRejectAction(){const reason = document.getElementById('reject_reason');const reasonText = reason ? reason.value.trim():'';let message = 'Tem certeza que deseja rejeitar este convite?\n\n';message += 'Esta ação não pode ser desfeita e o cliente será notificado.';if(reasonText){message += '\n\nMotivo informado:' + reasonText;}return confirm(message);}setButtonLoading(button,isLoading,originalText = '',loadingText = 'Carregando...'){if(!button)return;const icon = button.querySelector('i');const textSpan = button.querySelector('.btn-text')|| button;if(isLoading){button.disabled = true;button.classList.add('loading');if(icon){icon.className = 'fas fa-spinner fa-spin me-2';}if(textSpan && loadingText){textSpan.textContent = loadingText;}}else{button.disabled = false;button.classList.remove('loading');if(icon){if(button.classList.contains('accept-btn')){icon.className = 'fas fa-check me-2';}else if(button.classList.contains('reject-btn')){icon.className = 'fas fa-times me-2';}else{icon.className = 'fas fa-check me-2';}}if(textSpan && originalText){textSpan.textContent = originalText;}}}addFocusEffect(element){element.classList.add('focused');const parent = element.closest('.form-group,.mb-3');if(parent){parent.classList.add('focused');}}removeFocusEffect(element){element.classList.remove('focused');const parent = element.closest('.form-group,.mb-3');if(parent){parent.classList.remove('focused');}}updateFieldStatus(element){if(element.value.trim()){element.classList.add('has-value');}else{element.classList.remove('has-value');}}addHoverEffect(element){if(!element.disabled){element.classList.add('hover-effect');}}removeHoverEffect(element){element.classList.remove('hover-effect');}addFieldError(field,message){field.classList.add('is-invalid');field.classList.remove('is-valid');this.removeFieldFeedback(field);const feedback = document.createElement('div');feedback.className = 'invalid-feedback';feedback.textContent = message;field.parentNode.appendChild(feedback);}addFieldSuccess(field){field.classList.add('is-valid');field.classList.remove('is-invalid');this.removeFieldFeedback(field);}removeFieldError(field){field.classList.remove('is-invalid');this.removeFieldFeedback(field);}removeFieldFeedback(field){const feedback = field.parentNode.querySelector('.invalid-feedback,.valid-feedback');if(feedback){feedback.remove();}}showSuccessMessage(message){this.showToast(message,'success');}showErrorMessage(message){this.showToast(message,'error');}showInfoMessage(message){this.showToast(message,'info');}showToast(message,type = 'info'){let toastContainer = document.getElementById('toast-container');if(!toastContainer){toastContainer = document.createElement('div');toastContainer.id = 'toast-container';toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';toastContainer.style.zIndex = '9999';document.body.appendChild(toastContainer);}const toast = document.createElement('div');toast.className = `toast align-items-center text-white bg-${this.getBootstrapColor(type)}border-0`;toast.setAttribute('role','alert');toast.innerHTML = `
<div class="d-flex">
<div class="toast-body">
<i class="fas ${this.getToastIcon(type)}me-2"></i>
${message}</div>
<button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
</div>
`;toastContainer.appendChild(toast);const bsToast = new bootstrap.Toast(toast,{autohide:true,delay:type === 'error' ? 5000:3000});bsToast.show();toast.addEventListener('hidden.bs.toast',()=>{toast.remove();});}getBootstrapColor(type){const colors ={'success':'success','error':'danger','info':'info','warning':'warning'};return colors[type] || 'info';}getToastIcon(type){const icons ={'success':'fa-check-circle','error':'fa-exclamation-circle','info':'fa-info-circle','warning':'fa-exclamation-triangle'};return icons[type] || 'fa-info-circle';}isValidEmail(email){const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;return emailRegex.test(email);}isValidCPF(cpf){cpf = cpf.replace(/\D/g,'');if(cpf.length !== 11)return false;if(/^(\d)\1{10}$/.test(cpf))return false;let sum = 0;for(let i = 0;i < 9;i++){sum += parseInt(cpf.charAt(i))*(10 - i);}let remainder =(sum * 10)% 11;if(remainder === 10 || remainder === 11)remainder = 0;if(remainder !== parseInt(cpf.charAt(9)))return false;sum = 0;for(let i = 0;i < 10;i++){sum += parseInt(cpf.charAt(i))*(11 - i);}remainder =(sum * 10)% 11;if(remainder === 10 || remainder === 11)remainder = 0;if(remainder !== parseInt(cpf.charAt(10)))return false;return true;}}document.addEventListener('DOMContentLoaded',function(){window.inviteInteractions = new InviteInteractions();});