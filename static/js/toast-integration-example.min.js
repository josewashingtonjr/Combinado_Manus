function handleConviteSubmit(event){event.preventDefault();const form = event.target;const formData = new FormData(form);const submitButton = form.querySelector('button[type="submit"]');submitButton.disabled = true;submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';fetch(form.action,{method:'POST',body:formData}).then(response => response.json()).then(data =>{if(data.success){toast.success('Convite enviado com sucesso!');form.reset();setTimeout(()=>{window.location.href = data.redirect_url;},2000);}else{toast.error(data.message || 'Erro ao enviar convite');}}).catch(error =>{console.error('Erro:',error);toast.error('Erro de conexão. Tente novamente.');}).finally(()=>{submitButton.disabled = false;submitButton.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar Convite';});}function aceitarConvite(conviteId){if(!confirm('Deseja realmente aceitar este convite?')){return;}const toastId = toast.info('Processando...',0);fetch(`/prestador/aceitar-convite/${conviteId}`,{method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':document.querySelector('meta[name="csrf-token"]').content}}).then(response => response.json()).then(data =>{toast.hide(toastId);if(data.success){toast.success('Convite aceito! Redirecionando para pré-ordem...');setTimeout(()=>{window.location.href = data.redirect_url;},1500);}else{toast.error(data.message || 'Erro ao aceitar convite');}}).catch(error =>{toast.hide(toastId);console.error('Erro:',error);toast.error('Erro de conexão. Tente novamente.');});}function recusarConvite(conviteId){const motivo = prompt('Motivo da recusa(opcional):');const toastId = toast.info('Processando...',0);fetch(`/prestador/recusar-convite/${conviteId}`,{method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({motivo:motivo})}).then(response => response.json()).then(data =>{toast.hide(toastId);if(data.success){toast.success('Convite recusado');document.querySelector(`[data-convite-id="${conviteId}"]`)?.remove();}else{toast.error(data.message || 'Erro ao recusar convite');}}).catch(error =>{toast.hide(toastId);console.error('Erro:',error);toast.error('Erro de conexão. Tente novamente.');});}function validateForm(form){const errors = [];const requiredFields = form.querySelectorAll('[required]');requiredFields.forEach(field =>{if(!field.value.trim()){errors.push(`O campo "${field.labels[0]?.textContent || field.name}" é obrigatório`);}});const emailField = form.querySelector('input[type="email"]');if(emailField && emailField.value){const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!emailRegex.test(emailField.value)){errors.push('Email inválido');}}const phoneField = form.querySelector('input[type="tel"]');if(phoneField && phoneField.value){const phoneRegex = /^\(\d{2}\)\s?\d{4,5}-?\d{4}$/;if(!phoneRegex.test(phoneField.value)){errors.push('Telefone inválido. Use o formato(XX)XXXXX-XXXX');}}if(errors.length > 0){errors.forEach(error =>{toast.error(error,3000);});return false;}return true;}function handleFileUpload(input){const file = input.files[0];if(!file){return;}const maxSize = 5 * 1024 * 1024;if(file.size > maxSize){toast.error('Arquivo muito grande. Tamanho máximo:5MB');input.value = '';return;}const allowedTypes = ['image/jpeg','image/png','image/gif','application/pdf'];if(!allowedTypes.includes(file.type)){toast.error('Tipo de arquivo não permitido. Use JPG,PNG,GIF ou PDF');input.value = '';return;}toast.success(`Arquivo "${file.name}" selecionado`);const formData = new FormData();formData.append('file',file);const toastId = toast.info('Enviando arquivo...',0);fetch('/api/upload',{method:'POST',body:formData}).then(response => response.json()).then(data =>{toast.hide(toastId);if(data.success){toast.success('Arquivo enviado com sucesso!');}else{toast.error(data.message || 'Erro ao enviar arquivo');}}).catch(error =>{toast.hide(toastId);console.error('Erro:',error);toast.error('Erro ao enviar arquivo');});}function solicitarSaque(valor){if(valor <= 0){toast.error('Valor inválido');return;}const toastId = toast.info('Processando solicitação...',0);fetch('/prestador/solicitar-saque',{method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({valor:valor})}).then(response => response.json()).then(data =>{toast.hide(toastId);if(data.success){toast.success(`Saque de R$ ${valor.toFixed(2)}solicitado com sucesso!`);updateSaldoDisplay(data.novo_saldo);}else{toast.error(data.message || 'Erro ao solicitar saque');}}).catch(error =>{toast.hide(toastId);console.error('Erro:',error);toast.error('Erro de conexão. Tente novamente.');});}function adicionarSaldo(valor){if(valor <= 0){toast.error('Valor inválido');return;}toast.info('Redirecionando para pagamento...',2000);setTimeout(()=>{window.location.href = `/pagamento/adicionar-saldo?valor=${valor}`;},2000);}function setupRealtimeNotifications(){setInterval(()=>{fetch('/api/notificacoes/novas').then(response => response.json()).then(data =>{if(data.notificacoes && data.notificacoes.length > 0){data.notificacoes.forEach(notif =>{const type = notif.tipo || 'info';toast[type](notif.mensagem,7000);});}}).catch(error =>{console.error('Erro ao buscar notificações:',error);});},30000);}function copyToClipboard(text,label = 'Texto'){if(navigator.clipboard){navigator.clipboard.writeText(text).then(()=>{toast.success(`${label}copiado para área de transferência!`,2000);}).catch(err =>{console.error('Erro ao copiar:',err);toast.error('Erro ao copiar');});}else{const textarea = document.createElement('textarea');textarea.value = text;textarea.style.position = 'fixed';textarea.style.opacity = '0';document.body.appendChild(textarea);textarea.select();try{document.execCommand('copy');toast.success(`${label}copiado!`,2000);}catch(err){console.error('Erro ao copiar:',err);toast.error('Erro ao copiar');}document.body.removeChild(textarea);}}function deleteItem(itemId,itemName){const confirmToastId = toast.warning(`Tem certeza que deseja excluir "${itemName}"? Esta ação não pode ser desfeita.`,0);const toastElement = document.getElementById(confirmToastId);if(toastElement){const messageDiv = toastElement.querySelector('.toast-message');const buttonsDiv = document.createElement('div');buttonsDiv.style.marginTop = '10px';buttonsDiv.style.display = 'flex';buttonsDiv.style.gap = '8px';const confirmBtn = document.createElement('button');confirmBtn.textContent = 'Confirmar';confirmBtn.className = 'btn btn-sm btn-danger';confirmBtn.onclick =()=>{toast.hide(confirmToastId);performDelete(itemId,itemName);};const cancelBtn = document.createElement('button');cancelBtn.textContent = 'Cancelar';cancelBtn.className = 'btn btn-sm btn-secondary';cancelBtn.onclick =()=>{toast.hide(confirmToastId);toast.info('Ação cancelada');};buttonsDiv.appendChild(confirmBtn);buttonsDiv.appendChild(cancelBtn);messageDiv.appendChild(buttonsDiv);}}function performDelete(itemId,itemName){const toastId = toast.info('Excluindo...',0);fetch(`/api/items/${itemId}`,{method:'DELETE',headers:{'X-CSRFToken':document.querySelector('meta[name="csrf-token"]').content}}).then(response => response.json()).then(data =>{toast.hide(toastId);if(data.success){toast.success(`"${itemName}" excluído com sucesso`);document.querySelector(`[data-item-id="${itemId}"]`)?.remove();}else{toast.error(data.message || 'Erro ao excluir');}}).catch(error =>{toast.hide(toastId);console.error('Erro:',error);toast.error('Erro de conexão');});}let autoSaveTimeout;function setupAutoSave(form){const inputs = form.querySelectorAll('input,textarea,select');inputs.forEach(input =>{input.addEventListener('input',()=>{clearTimeout(autoSaveTimeout);autoSaveTimeout = setTimeout(()=>{autoSave(form);},2000);});});}function autoSave(form){const formData = new FormData(form);fetch(form.action,{method:'POST',body:formData}).then(response => response.json()).then(data =>{if(data.success){toast.success('Rascunho salvo automaticamente',2000);}}).catch(error =>{console.error('Erro no auto-save:',error);});}document.addEventListener('DOMContentLoaded',()=>{console.log('Toast Integration Examples carregado');});