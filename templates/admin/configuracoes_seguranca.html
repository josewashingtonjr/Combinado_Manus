{% extends "admin/base_admin.html" %}

{% block title %}Configurações de Segurança - Admin{% endblock %}

{% block admin_content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2><i class="fas fa-shield-alt me-2"></i>Configurações de Segurança</h2>
            <p class="text-muted">Gerencie as configurações de segurança do sistema</p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-lock me-2"></i>Configurações de Segurança</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('admin.salvar_configuracoes_seguranca') }}">
                        
                        <!-- Sessão -->
                        <div class="mb-4">
                            <h6 class="border-bottom pb-2"><i class="fas fa-clock me-2"></i>Sessão</h6>
                            
                            <div class="mb-3">
                                <label for="session_timeout" class="form-label">
                                    Timeout de Sessão (segundos)
                                    <i class="fas fa-info-circle text-muted" data-bs-toggle="tooltip" 
                                       title="Tempo em segundos antes da sessão expirar (300-86400)"></i>
                                </label>
                                <input type="number" class="form-control" id="session_timeout" 
                                       name="session_timeout" value="{{ settings.session_timeout }}" 
                                       min="300" max="86400" required>
                                <small class="form-text text-muted">
                                    Mínimo: 300 (5 minutos) | Máximo: 86400 (24 horas)
                                </small>
                            </div>
                        </div>

                        <!-- Autenticação -->
                        <div class="mb-4">
                            <h6 class="border-bottom pb-2"><i class="fas fa-key me-2"></i>Autenticação</h6>
                            
                            <div class="mb-3">
                                <label for="max_login_attempts" class="form-label">
                                    Máximo de Tentativas de Login
                                    <i class="fas fa-info-circle text-muted" data-bs-toggle="tooltip" 
                                       title="Número máximo de tentativas antes de bloquear (3-20)"></i>
                                </label>
                                <input type="number" class="form-control" id="max_login_attempts" 
                                       name="max_login_attempts" value="{{ settings.max_login_attempts }}" 
                                       min="3" max="20" required>
                                <small class="form-text text-muted">
                                    Mínimo: 3 | Máximo: 20
                                </small>
                            </div>

                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="enable_two_factor" 
                                       name="enable_two_factor" {% if settings.enable_two_factor %}checked{% endif %}>
                                <label class="form-check-label" for="enable_two_factor">
                                    Habilitar Autenticação de Dois Fatores (2FA)
                                </label>
                                <small class="form-text text-muted d-block">
                                    Requer código adicional para login
                                </small>
                            </div>
                        </div>

                        <!-- Senhas -->
                        <div class="mb-4">
                            <h6 class="border-bottom pb-2"><i class="fas fa-user-lock me-2"></i>Políticas de Senha</h6>
                            
                            <div class="mb-3">
                                <label for="password_min_length" class="form-label">
                                    Tamanho Mínimo da Senha
                                    <i class="fas fa-info-circle text-muted" data-bs-toggle="tooltip" 
                                       title="Número mínimo de caracteres (6-32)"></i>
                                </label>
                                <input type="number" class="form-control" id="password_min_length" 
                                       name="password_min_length" value="{{ settings.password_min_length }}" 
                                       min="6" max="32" required>
                                <small class="form-text text-muted">
                                    Mínimo: 6 | Máximo: 32
                                </small>
                            </div>

                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="require_password_complexity" 
                                       name="require_password_complexity" {% if settings.require_password_complexity %}checked{% endif %}>
                                <label class="form-check-label" for="require_password_complexity">
                                    Exigir Complexidade de Senha
                                </label>
                                <small class="form-text text-muted d-block">
                                    Requer letras maiúsculas, minúsculas, números e caracteres especiais
                                </small>
                            </div>
                        </div>

                        <!-- Controle de Acesso -->
                        <div class="mb-4">
                            <h6 class="border-bottom pb-2"><i class="fas fa-network-wired me-2"></i>Controle de Acesso</h6>
                            
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="ip_whitelist_enabled" 
                                       name="ip_whitelist_enabled" {% if settings.ip_whitelist_enabled %}checked{% endif %}>
                                <label class="form-check-label" for="ip_whitelist_enabled">
                                    Habilitar Whitelist de IPs
                                </label>
                                <small class="form-text text-muted d-block">
                                    Permite acesso apenas de IPs específicos
                                </small>
                            </div>

                            <div class="mb-3">
                                <label for="ip_whitelist" class="form-label">
                                    IPs Permitidos (separados por vírgula)
                                    <i class="fas fa-info-circle text-muted" data-bs-toggle="tooltip" 
                                       title="Ex: 192.168.1.1, 10.0.0.1"></i>
                                </label>
                                <textarea class="form-control" id="ip_whitelist" name="ip_whitelist" 
                                          rows="3" placeholder="192.168.1.1, 10.0.0.1">{{ settings.ip_whitelist }}</textarea>
                                <small class="form-text text-muted">
                                    Deixe em branco para permitir todos os IPs
                                </small>
                            </div>
                        </div>

                        <!-- Botões de Ação -->
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-1"></i>Voltar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Salvar Configurações
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Painel de Informações -->
        <div class="col-lg-4">
            <div class="card shadow-sm mb-3">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Informações</h6>
                </div>
                <div class="card-body">
                    <h6>Configurações de Segurança</h6>
                    <p class="small text-muted">
                        Estas configurações afetam a segurança de todo o sistema. 
                        Altere com cuidado e teste após cada modificação.
                    </p>
                    
                    <hr>
                    
                    <h6>Recomendações</h6>
                    <ul class="small text-muted">
                        <li>Timeout de sessão: 3600s (1 hora) para produção</li>
                        <li>Tentativas de login: 5 tentativas</li>
                        <li>Tamanho mínimo de senha: 8 caracteres</li>
                        <li>Sempre habilite complexidade de senha</li>
                        <li>Use 2FA para contas administrativas</li>
                    </ul>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Atenção</h6>
                </div>
                <div class="card-body">
                    <p class="small mb-0">
                        <strong>Importante:</strong> Alterações nas configurações de segurança 
                        podem afetar o acesso de usuários. Certifique-se de testar em ambiente 
                        de desenvolvimento antes de aplicar em produção.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Inicializar tooltips do Bootstrap
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
{% endblock %}
